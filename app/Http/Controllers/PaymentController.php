<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Nikolag\Square\Facades\Square;

class PaymentController extends Controller
{


    public function store(Request $request)
    {

        $amount = $request->totalPrice; //Is in USD currency and is in smallest denomination (cents). ($amount = 5000 == 50 Dollars)

        // convert to cents
        $amount = $amount * 100;

        // nonce reference => https://developer.squareup.com/docs/payment-form/payment-form-walkthrough
        // single-use token (nonce) generated by the client-side javascript library
        $formNonce = $request->sourceId;

        $location_id = env('SQUARE_LOCATION_ID'); //id of a location from Square

        // optional, default=USD
        $currency = 'USD'; //available currencies => https://developer.squareup.com/reference/square/objects/Currency

        // optional
        $note = 'This is my first payment to Square with this library'; //note about this charge

        // optional
        $reference_id = '25'; //some kind of reference id to an object or resource

        $options = [
            'amount' => $amount,
            'source_id' => $formNonce,
            'location_id' => $location_id,
            'currency' => $currency,
            'note' => $note,
            'reference_id' => $reference_id
        ];


        return Square::charge($options); // Simple charge
    }
}
